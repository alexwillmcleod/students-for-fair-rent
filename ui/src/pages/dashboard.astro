---
import Pledge from "@atoms/pledge.astro";
import StrikeStats from "@atoms/strike-stats.astro";
import axios from "axios";
import Layout from "layouts/layout.astro";
const isLoggedIn = Astro.cookies.has('authToken');
const baseUrl = import.meta.env.PUBLIC_API_BASE_URL;
axios.defaults.baseURL = baseUrl;
let pledges = [];
try {
  pledges = (await axios.get('/dashboard')).data;
} catch {

}
---

<Layout>
  <div class="px-4 py-4 lg:px-12 lg:py-6 flex flex-col gap-4">
    <h1 class="text-3xl font-bold">Dashboard:</h1>
    <div class="flex flex-col lg:flex-row gap-4">
      <div class="form w-full flex flex-col gap-4 bg-slate-50 bg-opacity-30 shadow-lg rounded-xl p-4 lg:p-8">
        <h2 class="text-2xl font-bold">Statistics:</h2>
        <StrikeStats />
      </div>
      <div class="form w-full lg:w-fit flex flex-col gap-4 bg-slate-50 bg-opacity-30 shadow-lg rounded-xl p-4 lg:p-8 justify-center items-center">
        {isLoggedIn ? 
      ( 
        <>
          <p class="text-lg">Go you! Thanks for striking :)</p>
          <a href="/logout" class="flex font-bold font-display bg-accent bg-opacity-60 shadow-lg  px-6 py-2 text-xl rounded-full">Log Out</a>
        </>
        ) : 
         (
          <p class="text-lg">You are not signed in</p>
          <div class="flex w-full justify-center items-center">
            <div class="grid h-20 place-items-center">
              <a href="/join" class="flex font-bold font-display bg-accent bg-opacity-60 shadow-lg  px-6 py-2 text-xl rounded-full">Join</a>
            </div>
            <div class="divider divider-horizontal">or</div>
            <div class="grid h-20 place-items-center">
              <a href="/login" class="flex font-bold font-display bg-accent bg-opacity-60 shadow-lg  px-6 py-2 text-lg rounded-full">Login</a>
            </div>
          </div>
         )
      }  
      </div>
    </div>
    
    <div class="form w-full flex flex-col gap-4 bg-slate-50 bg-opacity-30 shadow-lg rounded-xl p-4 lg:p-8">
      <h2 class="text-2xl font-bold">Pledges:</h2>
      <div class="flex flex-col w-full items-center gap-4 justify-center p-4">
        {pledges.length > 0 ? pledges.map((element: any) => (
          <Pledge {...element} />
        )) : <div class="w-full h-40 skeleton bg-primary/20"/>}
      </div>
    </div>
  </div>
   
</Layout>